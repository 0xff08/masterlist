import React, {useState} from 'react';
import {Form, Input, Button, Layout, Flex, Col, Row} from 'antd';
import {useNavigate} from "react-router-dom";
import supabase from "../supabase.js";

const LoginPage = () => {
  const navigate = useNavigate();
  const [error, setError] = useState("");

  const onFinish = async ({email, password}) => {
    await supabaseSignInWithEmailAndPassword(email, password);
  };

  const supabaseSignInWithEmailAndPassword = async (email, password) => {
      try {
        const { data, error } = await supabase.auth.signInWithPassword({email, password});
        // Redirect to dashboard after successful login
        if (!error) {
          console.log(data);
          navigate("/search");
        }
        setError(error.message)
        // console.error(error)
      } catch (err) {
        setError(err.message);
        // console.error(err);
      }
  }

  const onFinishFailed = (errorInfo) => {
    console.log('Failed:', errorInfo);
  };

  return (
    <Row style={{width: '100%', height: '100vh'}}>
      <Row justify={'center'} align={'middle'} style={{width: '100vw', marginTop: '-100px'}}>
        <Form
          title="Login"
          name="login"
          initialValues={{ remember: true }}
          onFinish={onFinish}
          onFinishFailed={onFinishFailed}
          autoComplete="off"
          size={'large'}
          style={{maxWidth: '400px'}}
        >
          <Form.Item noStyle style={{marginTop: -20}}>
            <svg width="400" height="304" viewBox="0 0 938 304" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g filter="url(#filter0_d_37_274)">
                <path d="M260.561 63.8093L258.925 65.8086C237.296 93.6172 205.125 110.521 170.41 112.702C167.865 112.883 165.139 112.883 162.595 112.883H127.334V247.928H84.2579V112.883H41V70.8978H165.684C189.494 70.1708 211.305 58.9019 226.027 39.9993L227.663 38L260.561 63.8093ZM203.49 208.669C198.946 208.669 195.311 207.215 192.584 204.488C189.858 201.58 188.404 198.127 188.404 193.765C188.404 189.402 189.858 185.586 192.948 182.496C196.038 179.406 199.673 177.77 203.853 177.77C208.397 177.77 212.032 179.406 214.758 182.678C217.485 185.949 218.939 190.493 218.939 196.127V248.11H258.925V193.401C258.925 175.953 254.018 162.139 244.021 152.143C234.025 142.146 220.575 137.057 203.308 137.057C188.04 137.057 174.954 142.51 164.23 153.233C153.325 164.138 148.054 177.043 148.054 192.311C148.054 207.578 153.325 221.21 164.049 231.933C174.772 242.657 188.04 247.928 204.035 247.928C207.125 247.928 210.033 247.564 212.941 247.019V205.942C210.033 207.76 206.943 208.487 203.49 208.487V208.669ZM313.634 160.867C313.634 146.69 318.723 139.783 329.083 139.783C333.263 139.783 336.898 141.237 339.988 144.327C343.078 147.417 344.532 150.87 344.532 154.869C344.532 159.231 343.078 162.866 340.17 165.956C337.262 168.864 333.808 170.5 329.628 170.5C326.175 170.5 322.721 169.228 319.631 166.865V210.668C322.903 211.213 325.993 211.577 329.264 211.577C344.35 211.577 357.437 206.124 368.342 195.219C379.247 184.313 384.882 171.227 384.882 155.778C384.882 140.328 379.429 127.242 368.524 116.7C357.618 106.158 344.168 100.706 328.356 100.706C312.543 100.706 299.638 106.158 289.278 117.245C278.918 128.333 273.647 142.51 273.647 159.776V248.291H313.634V161.23V160.867ZM473.033 159.049C468.853 159.049 465.763 158.504 463.764 157.595C461.764 156.686 460.856 154.505 460.856 151.416C460.856 146.69 464.491 144.145 471.943 144.145H507.385V102.342H462.128C447.587 102.342 436.319 106.158 428.321 113.974C420.324 121.789 416.325 132.513 416.325 146.508V203.398C416.325 217.756 420.506 228.843 429.048 236.477C437.591 244.111 449.769 247.928 465.763 247.928H507.385V206.488H470.67C465.4 206.488 462.128 205.942 460.492 205.033C459.038 203.943 458.129 201.944 458.129 198.854C458.129 196.309 458.856 194.31 460.492 193.219C462.128 192.129 464.854 191.402 468.489 191.402H504.295V159.049H472.852H473.033ZM526.469 102.342V247.746H566.456V102.342H526.469ZM694.412 193.583C694.412 178.134 689.141 165.229 678.599 154.869C668.057 144.509 655.152 139.238 639.885 139.238C624.617 139.238 610.441 144.509 599.717 155.232C588.993 165.956 583.541 179.042 583.541 194.673C583.541 210.304 588.993 223.573 599.717 234.296C610.622 245.02 623.709 250.291 639.34 250.291C652.426 250.291 664.24 246.11 674.6 237.931L651.881 210.486C648.246 214.485 644.429 216.666 640.248 216.666C635.523 216.666 631.524 214.485 628.434 209.941C625.344 205.397 623.89 199.944 623.89 193.038C623.89 186.131 625.526 180.86 628.616 176.68C631.888 172.499 635.886 170.318 640.612 170.318C648.246 170.318 652.608 174.317 653.88 182.314H633.523C632.251 185.767 631.524 189.221 631.524 192.311C631.524 195.219 632.069 198.127 632.978 201.035H693.321C693.685 196.673 693.685 194.128 693.685 193.583H694.412ZM775.293 199.399C774.202 203.034 772.385 205.942 769.477 207.942C766.569 209.941 763.479 211.031 760.025 211.031C755.663 211.031 751.846 209.396 748.757 206.124C745.667 202.852 744.031 199.036 744.031 194.673C744.031 190.311 745.667 186.494 748.757 183.405C751.846 180.315 755.663 178.679 760.025 178.679C765.478 178.679 769.84 180.86 773.112 185.404L814.189 184.132C811.462 170.682 804.919 159.776 794.741 151.597C784.562 143.418 772.93 139.42 760.025 139.42C744.94 139.42 731.853 144.872 721.13 155.596C710.224 166.501 704.953 179.406 704.953 194.673C704.953 209.941 710.406 223.027 721.13 233.933C732.035 244.838 744.94 250.291 760.025 250.291C774.202 250.291 786.744 245.383 797.467 235.75C808.191 225.935 814.007 213.394 815.279 197.945L775.293 199.399ZM828.184 102.342V190.493C828.184 209.577 833.273 224.3 843.633 234.66C853.993 245.02 868.352 250.291 886.527 250.291V208.487C879.439 208.487 874.532 206.851 871.987 203.761C869.442 200.49 867.988 194.673 867.988 186.313H885.8V144.145H867.988V102.523H828.002L828.184 102.342ZM735.125 114.701L784.381 69.262L759.662 42.5439L710.406 87.9828C705.862 92.1632 698.592 92.1632 694.048 87.9828L676.054 70.8978L650.972 97.2523L668.966 114.337C678.235 123.243 690.231 127.606 702.227 127.606C714.223 127.606 725.674 123.425 734.943 114.883L735.125 114.701ZM405.965 247.928C405.965 231.206 392.515 217.756 375.794 217.756C359.072 217.756 345.623 231.206 345.623 247.928H405.965Z" fill="white"/>
              </g>
              <defs>
                <filter id="filter0_d_37_274" x="0.5" y="0.5" width="936.527" height="303.291" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                  <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                  <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
                  <feOffset dx="5" dy="8"/>
                  <feGaussianBlur stdDeviation="22.75"/>
                  <feComposite in2="hardAlpha" operator="out"/>
                  <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.1 0"/>
                  <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_37_274"/>
                  <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_37_274" result="shape"/>
                </filter>
              </defs>
            </svg>
          </Form.Item>
          <Form.Item
            name="email"
            rules={[
              { required: true, message: 'Please input your email!' },
              { type: 'email', message: 'Please enter a valid email!' },
            ]}
          >
            <Input placeholder="Email" />
          </Form.Item>

          <Form.Item
            name="password"
            rules={[{ required: true, message: 'Please input your password!' }]}
          >
            <Input.Password placeholder="Password" />
          </Form.Item>
          <Form.Item noStyle>
            {error.message}
          </Form.Item>
          <Form.Item>
            <Button type="primary" htmlType="submit" block>
              Login
            </Button>
          </Form.Item>
        </Form>
      </Row>
    </Row>
  );
};

export default LoginPage;